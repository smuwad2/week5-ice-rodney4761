<!DOCTYPE html>
<html>
    <head>

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        
         <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="bg-light text-center p-5 mb-4">
            <h2>Choose an option:</h2>
            <label for="limit">Limit:</label>
            <input id="limit" type="number" min=1 max=5 value=1>
            <select onchange="getData()" id="type">
                <option value="customers">Customers</option>
                <option value="products">Products</option>
                <option value="suppliers">Suppliers</option>
            </select>
            
        </div>
        <div id="result">

        </div>
        <script>
            async function getData() {
                try {
                    var userType = document.getElementById("type").value;
                    var userLimit = document.getElementById("limit").value;
                    var response = await axios.get("/data", {
                        params : {
                        type : userType,
                        limit : userLimit
                        }
                    }
                    )
                    console.log(response.data);
                    generateTable(response.data);

                }
                catch(err) {
                    console.error(err);
                }
            }

            function generateTable(obj) {
              var type = obj.type;
              var arr = obj.records;

              // console.log(arr);

              var target = document.getElementById("result");
              
              // Create H2 Elem
              const h2Elem = document.createElement("h2");
              const h2ElemTextNode = document.createTextNode(type);
              h2Elem.appendChild(h2ElemTextNode);


              // clear target first
              target.replaceChildren();

              target.appendChild(h2Elem);

              // Create <table>
                
              var table = document.createElement("table");

              table.setAttribute("class", "table table-striped");

              var tableBody = document.createElement("tbody");
              var tableTHrow = document.createElement("tr");

              var firstObj = arr[0];
              for (let heading in firstObj) {
                  var tableTH = document.createElement("th");
                  const thText = document.createTextNode(heading);
                  tableTH.appendChild(thText);
                  tableTHrow.appendChild(tableTH);
              }

              tableBody.appendChild(tableTHrow);
              target.appendChild(tableBody);



              for (let arrObj of arr) {
                var tableRow = document.createElement("tr");
                for (let heading in arrObj) {
                    var tableData = document.createElement("td");
                    var value = arrObj[heading];
                    var tdTextNode = document.createTextNode(value);
                    
                    tableData.appendChild(tdTextNode);
                    tableRow.appendChild(tableData);
                }
                tableBody.appendChild(tableRow);
              }

                table.appendChild(tableBody);
                target.appendChild(table);
            }

        </script>
</body>
</html>